<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paint By Number</title>
<style>
  body { font-family: Arial; text-align: center; margin: 0; padding: 10px; }
  canvas { border:1px solid #000; touch-action: none; display: block; margin: 0 auto; max-width: 100%; height: auto; }
  #palette { display: flex; flex-wrap: wrap; justify-content: center; margin: 10px; }
  .color-btn { width: 40px; height: 40px; margin: 2px; border: 1px solid #000; cursor: pointer; }
</style>
</head>
<body>

<h2>Fotoğraf Yükle ve Boya</h2>
<input type="file" id="upload" accept="image/*"><br><br>
<canvas id="canvas"></canvas>
<div id="palette"></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let gridSize = 20; // Kare boyutu
let colorMap = {}; // Renk -> numara
let colorList = []; // Renk sırası
let currentColor = null;
const maxWidth = 500; // Mobil için maksimum genişlik
const maxHeight = 500; // Mobil için maksimum yükseklik

document.getElementById('upload').addEventListener('change', function(e){
    const file = e.target.files[0];
    if(!file) return;
    const img = new Image();
    img.onload = () => {
        // Oranı koruyarak yeniden boyutlandır
        let scale = Math.min(maxWidth/img.width, maxHeight/img.height, 1);
        canvas.width = img.width * scale;
        canvas.height = img.height * scale;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        createGrid();
    };
    img.src = URL.createObjectURL(file);
});

function createGrid(){
    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const data = imageData.data;
    colorMap = {};
    colorList = [];
    let colorCount = 1;

    for(let y=0; y<canvas.height; y+=gridSize){
        for(let x=0; x<canvas.width; x+=gridSize){
            const idx = (((y + gridSize/2)|0)*canvas.width + ((x + gridSize/2)|0))*4;
            const r = data[idx], g = data[idx+1], b = data[idx+2];
            const color = `rgb(${r},${g},${b})`;

            if(!colorMap[color]){
                colorMap[color] = colorCount++;
                colorList.push(color);
            }

            ctx.fillStyle = color;
            ctx.fillRect(x,y,gridSize,gridSize);

            ctx.fillStyle = "black";
            ctx.font = `${gridSize/2}px Arial`;
            ctx.fillText(colorMap[color], x+gridSize/4, y+gridSize*0.7);
        }
    }
    createPalette();
}

function createPalette(){
    const paletteDiv = document.getElementById('palette');
    paletteDiv.innerHTML = '';
    colorList.forEach(color => {
        const btn = document.createElement('div');
        btn.className = 'color-btn';
        btn.style.backgroundColor = color;
        btn.onclick = ()=> currentColor = color;
        paletteDiv.appendChild(btn);
    });
}

let isDrawing = false;
canvas.addEventListener('pointerdown', e => { isDrawing = true; paint(e); });
canvas.addEventListener('pointerup', e => { isDrawing = false; });
canvas.addEventListener('pointermove', e => { if(isDrawing) paint(e); });

function paint(e){
    if(!currentColor) return;
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((e.clientX-rect.left)/gridSize)*gridSize;
    const y = Math.floor((e.clientY-rect.top)/gridSize)*gridSize;
    ctx.fillStyle = currentColor;
    ctx.fillRect(x,y,gridSize,gridSize);
}
</script>

</body>
</html>
